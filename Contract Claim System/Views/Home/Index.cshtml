@using Contract_Claim_System.Data
@{
    ViewData["Title"] = "Dashboard";
    var role = Context.Session.GetString("UserRole");
    var email = Context.Session.GetString("UserEmail");

    var latestClaim = InMemoryDb.Claims
        .OrderByDescending(c => c.SubmittedDate)
        .FirstOrDefault();
}

<div class="container">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card bg-primary text-white shadow">
                <div class="card-body">
                    <h2><i class="bi bi-speedometer2"></i> Dashboard</h2>
                    @if (!string.IsNullOrEmpty(role) && !string.IsNullOrEmpty(email))
                    {
                        <p class="lead mb-0">Welcome back, <strong>@email</strong></p>
                        <p class="mb-0">Role: <span class="badge bg-light text-dark">@role</span></p>
                    }
                </div>
            </div>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(role))
    {
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="bi bi-clock-history"></i> Latest Claim Submitted</h5>
                    </div>
                    <div class="card-body">
                        @if (latestClaim != null)
                        {
                            <div class="row g-3">
                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100">
                                        <small class="text-muted d-block mb-1">Claim ID</small>
                                        <h6 class="mb-0">
                                            <code class="text-primary">#@latestClaim.ClaimId</code>
                                        </h6>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100">
                                        <small class="text-muted d-block mb-1">Lecturer</small>
                                        <h6 class="mb-0">@(latestClaim.LecturerDisplayName ?? latestClaim.LecturerName)</h6>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100">
                                        <small class="text-muted d-block mb-1">Module</small>
                                        <h6 class="mb-0">
                                            <span class="badge bg-info">@latestClaim.Module</span>
                                        </h6>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100">
                                        <small class="text-muted d-block mb-1">Period</small>
                                        <h6 class="mb-0">@latestClaim.Period</h6>
                                    </div>
                                </div>

                                <div class="col-md-2">
                                    <div class="border rounded p-3 h-100 text-center">
                                        <small class="text-muted d-block mb-1">Hours</small>
                                        <h5 class="mb-0 text-primary">@latestClaim.HoursWorked</h5>
                                    </div>
                                </div>

                                <div class="col-md-2">
                                    <div class="border rounded p-3 h-100 text-center">
                                        <small class="text-muted d-block mb-1">Rate</small>
                                        <h5 class="mb-0 text-info">@latestClaim.HourlyRate.ToString("C")</h5>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100 text-center bg-light">
                                        <small class="text-muted d-block mb-1">Total Amount</small>
                                        <h4 class="mb-0 text-success">@latestClaim.TotalAmount.ToString("C")</h4>
                                    </div>
                                </div>

                                <div class="col-md-2">
                                    <div class="border rounded p-3 h-100 text-center">
                                        <small class="text-muted d-block mb-1">Status</small>
                                        @if (latestClaim.Status == "Pending")
                                        {
                                            <span class="badge bg-warning text-dark fs-6">
                                                <i class="bi bi-clock"></i> Pending Review
                                            </span>
                                        }
                                        else if (latestClaim.Status == "Approved")
                                        {
                                            <span class="badge bg-success fs-6">
                                                <i class="bi bi-check-circle"></i> Approved
                                            </span>
                                        }
                                        else if (latestClaim.Status == "Rejected")
                                        {
                                            <span class="badge bg-danger fs-6">
                                                <i class="bi bi-x-circle"></i> Rejected
                                            </span>
                                        }
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="border rounded p-3 h-100 text-center">
                                        <small class="text-muted d-block mb-1">Submitted</small>
                                        <h6 class="mb-0">@latestClaim.SubmittedDate.ToString("yyyy/MM/dd")</h6>
                                    </div>
                                </div>
                            </div>

                            <div class="mt-3 text-end">
                                <a asp-controller="Claims" asp-action="Details" asp-route-id="@latestClaim.ClaimId"
                                   class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i> View Full Details
                                </a>
                                @if (role == "Academic Manager")
                                {
                                    <a asp-controller="Claims" asp-action="List" class="btn btn-sm btn-primary">
                                        <i class="bi bi-list"></i> View All Claims
                                    </a>
                                }
                                else if (role == "Project Coordinator")
                                {
                                    <a asp-controller="ProjectCoordinator" asp-action="Index" class="btn btn-sm btn-primary">
                                        <i class="bi bi-kanban"></i> Project Coordinator Panel
                                    </a>
                                }
                                else if (role == "Lecturer")
                                {
                                    <a asp-controller="Claims" asp-action="Track" class="btn btn-sm btn-primary">
                                        <i class="bi bi-list"></i> View My Claims
                                    </a>
                                }
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-4">
                                <i class="bi bi-inbox" style="font-size: 3rem; color: #6c757d;"></i>
                                <h5 class="mt-3 text-muted">No claims have been submitted yet</h5>
                                @if (role == "Lecturer")
                                {
                                    <a asp-controller="Claims" asp-action="Submit" class="btn btn-primary mt-2">
                                        <i class="bi bi-plus-circle"></i> Submit First Claim
                                    </a>
                                }
                                else if (role == "Academic Manager")
                                {
                                    <p class="text-muted mt-2">Waiting for lecturers to submit claims</p>
                                }
                                else if (role == "Project Coordinator")
                                {
                                    <p class="text-muted mt-2">No claims available for coordination</p>
                                }
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        @if (role == "Lecturer")
        {
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-file-earmark-plus" style="font-size: 3rem; color: #0d6efd;"></i>
                            </div>
                            <h4 class="card-title">Submit a Claim</h4>
                            <p class="card-text">Create and submit a new contract claim for payment.</p>
                            <a asp-controller="Claims" asp-action="Submit" class="btn btn-primary">Submit Claim</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-clipboard-check" style="font-size: 3rem; color: #198754;"></i>
                            </div>
                            <h4 class="card-title">Track My Claims</h4>
                            <p class="card-text">View the status of all your submitted claims.</p>
                            <a asp-controller="Claims" asp-action="Track" class="btn btn-success">Track Claims</a>
                        </div>
                    </div>
                </div>
            </div>
        }
        else if (role == "Academic Manager")
        {
            <div class="row g-4">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-list-check" style="font-size: 2.5rem; color: #0d6efd;"></i>
                            </div>
                            <h5 class="card-title">View All Claims</h5>
                            <p class="card-text">Review and manage all submitted claims.</p>
                            <a asp-controller="Claims" asp-action="List" class="btn btn-primary btn-sm">View Claims</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-person-plus" style="font-size: 2.5rem; color: #198754;"></i>
                            </div>
                            <h5 class="card-title">Add Lecturer</h5>
                            <p class="card-text">Register a new lecturer in the system.</p>
                            <a asp-controller="Lecturers" asp-action="Create" class="btn btn-success btn-sm">Add Lecturer</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-people" style="font-size: 2.5rem; color: #ffc107;"></i>
                            </div>
                            <h5 class="card-title">Manage Lecturers</h5>
                            <p class="card-text">View and manage all lecturers.</p>
                            <a asp-controller="Lecturers" asp-action="Index" class="btn btn-warning btn-sm">Manage</a>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-file-earmark-bar-graph" style="font-size: 2.5rem; color: #dc3545;"></i>
                            </div>
                            <h5 class="card-title">Reports</h5>
                            <p class="card-text">Generate and export claims reports.</p>
                            <a asp-controller="Reports" asp-action="Index" class="btn btn-danger btn-sm">View Reports</a>
                        </div>
                    </div>
                </div>
            </div>
        }
        else if (role == "Project Coordinator")
        {
            <div class="row g-4 justify-content-center">
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-kanban" style="font-size: 2.5rem; color: #6f42c1;"></i>
                            </div>
                            <h5 class="card-title">Project Coordinator</h5>
                            <p class="card-text">Access exclusive coordinator panel.</p>
                            <a asp-controller="ProjectCoordinator" asp-action="Index" class="btn btn-primary btn-sm" style="background-color: #6f42c1; border-color: #6f42c1;">Coordinator Panel</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-3">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body text-center">
                            <div class="mb-3">
                                <i class="bi bi-file-earmark-bar-graph" style="font-size: 2.5rem; color: #dc3545;"></i>
                            </div>
                            <h5 class="card-title">Reports</h5>
                            <p class="card-text">Generate and export claims reports.</p>
                            <a asp-controller="Reports" asp-action="Index" class="btn btn-danger btn-sm">View Reports</a>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-warning">
                    <h4 class="alert-heading">Not Logged In</h4>
                    <p>You are not logged in. Please <a asp-controller="Account" asp-action="Login" class="alert-link">login</a> to access the system.</p>
                    <hr>
                    <p class="mb-0">Don't have an account? <a asp-controller="Account" asp-action="Register" class="alert-link">Register here</a>.</p>
                </div>
            </div>
        </div>
    }
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">